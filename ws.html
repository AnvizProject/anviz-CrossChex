<!DOCTYPE html>

<html>


<head>

    <meta charset="UTF-8">

    <title>ws</title>


</head>
　　<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>

<body>

<form id="upload" enctype="multipart/form-data" method="post">


    <input type="button" value="download_user" id="download_user"/>
    <input type="button" value="upload_user" id="upload_user"/>
    <input type="button" value="download_template" id="download_template"/>
    <input type="button" value="upload_template" id="upload_template"/><br>
    <input type="button" value="delete_from_device" id="delete_from_device"/><br>
    <input type="button" value="sync_time" id="sync_time"/><br>
    <input type="button" value="device_param" id="device_param"/><br>
    <input type="button" value="clean_record" id="clean_record"/><br>
    <input type="button" value="init_device" id="init_device"/><br>
    <input type="button" value="ring_setting" id="ring_setting"/><br>
    <input type="button" value="read_new_record" id="read_new_record"/><br>
    <input type="button" value="read_all_record" id="read_all_record"/><br>
    <input type="button" value="read_record" id="read_record"/><br>
    <input type="button" value="backup_user" id="backup_user"/><br>
    <input type="button" value="recover_user" id="recover_user"/><br>
    <input type="button" value="start_real_time" id="start_real_time"/><br>

    <input type="button" value="set_net_param" id="set_net_param"/><br>
    <input type="button" value="device_info" id="device_info"/><br>
    <input type="button" value="open_door" id="open_door"/><br>
    <input type="button" value="msg_manage" id="msg_manage"/><br>
    <input type="button" value="clear_manager" id="clear_manager"/><br>
    <input type="button" value="set_clientid" id="set_clientid"/><br>
    <input type="button" value="set_admin_card" id="set_admin_card"/><br>
    <input type="button" value="photo_manage" id="photo_manage"/><br>
    <input type="button" value="set_gprs" id="set_gprs"/><br>
    <input type="button" value="update_firmware" id="update_firmware"/><br>
    <input type="button" value="auto_set" id="auto_set"/><br>
    <input type="button" value="update_status" id="update_status"/><br>
    <input type="button" value="update_accesstime" id="update_accesstime"/><br>

    <input type="button" value="stat_analysis" id="stat_analysis"/><br>
    <input type="button" value="search_stat_result" id="search_stat_result"/><br>

    <input type="button" value="export_current_data" id="export_current_data"/><br>

    <input type="button" value="export_current_data_z_mem_abnor" id="export_current_data_z_mem_abnor"/><br>

</form>

<script type="text/javascript">

    var hostname = location.hostname;
    var ws = new WebSocket('ws://47.101.160.190:8081'); //创建WebSocket连接
    ws.onopen = function (evt) {
        console.log("Connection open ...");
        // console.log(hostname);

        if(hostname != '127.0.0.1'){
            ws.send('{"cmd":"login","data":{"access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJPcGlkIjoxLCJPUE5hbWUiOiJBZG1pbiIsIk9QUHdkIjoiOTZlNzkyMTg5NjVlYjcyYzkyYTU0OWRkNWEzMzAxMTIiLCJpYXQiOjE1ODI4NzQzOTF9.ARSAziQZd8bhLoIPQa1-NkNmuWCEJE7wkyIzlr5WDck"}}');

        }else {
            ws.send('{"cmd":"login","data":{"access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJPcGlkIjoiMSIsIk9QTmFtZSI6IkFkbWluIiwiT1BQd2QiOiJkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZSIsImlhdCI6MTU4MjU5ODM4OH0.bdeROXo-jzhBPQpRgC8qJSicbdgG7UrFe528vupH7B0"}}');

        }

        setInterval(function () {
            ws.send('{"cmd":"ping"}');
        }, 3000);
    };

    ws.onmessage = function(evt){
        console.log(JSON.parse(evt.data));
    };
    ws.onclose = function(evt){
        //当客户端收到服务端发送的关闭连接请求时，触发onclose事件
        console.log("close");
    };

    $("#download_user").click(function(){
         ws.send('{"cmd":"download_user","uuid":"5e43b6994998e","data":{"ClientNumber":"1000","limits":"2","ts":"1581495961"},"sign":"b326b5062b2f0e69046810717534cb09"}');
    });
    $("#download_template").click(function(){
        ws.send('{"cmd":"download_template","uuid":"5e43b6994998e","data":{"ClientNumber":"1000","limits":"2","ts":"1581495961"},"sign":"b326b5062b2f0e69046810717534cb09"}');
    });

    $("#upload_user").click(function(){
        ws.send('{"cmd":"upload_user","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","userinfo_list":[{"userid":"17","Pwd":"123","Cardnum":"123","Name":"张三","Deptid":"1","Groupid":"1","UserFlag":"1","Finger1":"0","Finger2":"1","Power":"1"}]}}');
    });
    $("#upload_template").click(function(){
        ws.send('{"cmd":"upload_template","uuid":"abc123","ts":"1577438087","data":{"ts":"1577438087","ClientNumber":"100","template_list":[{"userid":"17","template":"xxxx","fingerid":"1"},{"userid":"18","template":"xxxx","fingerid":"1"}]}}');
    });

    $("#delete_from_device").click(function(){
        ws.send('{"cmd":"delete_from_device","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","userids":"1,2,3"}}');
    });
    $("#sync_time").click(function(){
        ws.send('{"cmd":"sync_time","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100"}}');
    });
    $("#device_param").click(function(){
        ws.send('{"cmd":"device_param","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","precision":"0","record_alarm_value":"1000","repeat_clock_time":"100","workcode_prompt":"0","realtime_monitor":"0","ring":"0","update_fingerprint":"100","wiegand_mode":"0","wiegand_area_code":"100","relay_time":"100","door_alarm_delay":"100","card_mode":"100","anti_passback":"100","wiegand_option":"100","save_invalid_record":"100","read_card_mode":"100","user_period_limit":"100","pwd":"100","sleep_time":"100","volume":"100","date_format":"100","time_format":"100","company_name":"100","address":"100","fax":"100"}}');
    });

    $("#clean_record").click(function(){
        ws.send('{"cmd":"clean_record","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100"}}');
    });
    $("#init_device").click(function(){
        ws.send('{"cmd":"init_device","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100"}}');
    });
    $("#ring_setting").click(function(){
        ws.send('{"cmd":"ring_setting","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100"}}');
    });

    $("#read_new_record").click(function(){
        ws.send('{"cmd":"read_new_record","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#read_all_record").click(function(){
        ws.send('{"cmd":"read_all_record","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#read_record").click(function(){
        ws.send('{"cmd":"read_record","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","start_date":"2020-2-1","end_date":"2020-2-10","userid":"2","limits":"10"}}');
    });

    $("#backup_user").click(function(){
        ws.send('{"cmd":"backup_user","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });

    $("#recover_user").click(function(){
        ws.send('{"cmd":"recover_user","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });

    $("#start_real_time").click(function(){
        ws.send('{"cmd":"start_real_time","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });

    $("#set_net_param").click(function(){
        ws.send('{"cmd":"set_net_param","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });

    $("#device_info").click(function(){
        ws.send('{"cmd":"device_info","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#open_door").click(function(){
        ws.send('{"cmd":"open_door","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#msg_manage").click(function(){
        ws.send('{"cmd":"msg_manage","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#clear_manager").click(function(){
        ws.send('{"cmd":"clear_manager","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#set_clientid").click(function(){
        ws.send('{"cmd":"set_clientid","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#set_admin_card").click(function(){
        ws.send('{"cmd":"set_admin_card","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#photo_manage").click(function(){
        ws.send('{"cmd":"photo_manage","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#set_gprs").click(function(){
        ws.send('{"cmd":"set_gprs","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#update_firmware").click(function(){
        ws.send('{"cmd":"update_firmware","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#auto_set").click(function(){
        ws.send('{"cmd":"auto_set","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","limits":"10"}}');
    });
    $("#update_status").click(function(){
        ws.send('{"cmd":"update_status","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100"}}');
    });

    $("#update_accesstime").click(function(){
        ws.send('{"cmd":"update_accesstime","uuid":"abc123","data":{"ts":"1577438087","ClientNumber":"100","userids":"1,2"}}');
    });

    $("#stat_analysis").click(function(){
        ws.send('{"cmd":"stat_analysis","uuid":"abc123","data":{"ts":"1577438087","deptid":"2","userid":"1","start_date":"2020-2-1","end_date":"2020-2-28"}}');
    });

    $("#search_stat_result").click(function(){
        ws.send('{"cmd":"search_stat_result","uuid":"abc123","data":{"ts":"1577438087","deptid":"2","userid":"1","start_date":"2020-2-1","end_date":"2020-2-28"}}');
    });

    $("#export_current_data").click(function(){
        ws.send('{"cmd":"export_current_data","uuid":"abc123","data":{"ts":"1577438087","type":"z_mem_record"}}');
    });

    $("#export_current_data_z_mem_abnor").click(function(){
        ws.send('{"cmd":"export_current_data","uuid":"abc123","data":{"ts":"1577438087","type":"z_mem_abnor","deptid":"0","userid":"0","start_date":"2020-2-1","end_date":"2020-2-28"}}');
    });
</script>

</body>

</html>